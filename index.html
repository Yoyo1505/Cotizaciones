<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Cotización</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .header img {
            margin-right: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #2196F3;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        input[type="text"], input[type="number"], input[type="email"] {
            padding: 8px;
            margin: 5px 0;
            width: 200px;
        }
        input[type="number"] {
            width: 80px;
        }
        .price {
            text-align: right;
        }
        button {
            margin: 10px 0;
            padding: 10px 15px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0b7dda;
        }
        .remove-btn {
            background-color: #f44336;
            padding: 5px 10px;
            font-size: 14px;
        }
        .remove-btn:hover {
            background-color: #d32f2f;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .total-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        #client-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <img id="logo" src="https://raw.githubusercontent.com/tu_usuario/tu_repositorio/main/logo.png" alt="Logotipo" style="width:150px;height:auto;">
        <div>
            <h1>Generador de Cotización</h1>
            <p>Richy Entertainment S.A.S. de C.V.</p>
        </div>
    </div>

    <div id="client-info">
        <h2>Datos del Cliente</h2>
        <div class="form-group">
            <label>Número de Folio: </label>
            <input type="text" id="folio-number" placeholder="Folio">
        </div>
        <div class="form-group">
            <label>Nombre del Cliente: </label>
            <input type="text" id="client-name" placeholder="Nombre del Cliente">
        </div>
        <div class="form-group">
            <label>Ciudad: </label>
            <input type="text" id="client-city" placeholder="Ciudad">
        </div>
        <div class="form-group">
            <label>Teléfono: </label>
            <input type="text" id="client-phone" placeholder="Teléfono">
        </div>
        <div class="form-group">
            <label>Email: </label>
            <input type="email" id="client-email" placeholder="Email">
        </div>
    </div>

    <div>
        <h2>Ítems de la Cotización</h2>
        <div class="form-group">
            <label>Agregar Ítem: </label>
            <select id="item-select">
                <option value="">Selecciona un ítem</option>
            </select>
            <button id="add-item-btn">Agregar Ítem</button>
        </div>

        <table id="items">
            <thead>
                <tr>
                    <th>Cant.</th>
                    <th>Concepto</th>
                    <th>Vehículo/Servicio</th>
                    <th>Precio Unitario</th>
                    <th>Total</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="total-section">
        <div class="form-group">
            <label>Impuestos (%): </label>
            <input type="number" id="tax" value="16" min="0" step="0.1" onchange="calculateTotal()">
        </div>
        <div>
            <strong style="font-size: 18px;">Total: <span id="total">$0.00</span></strong>
        </div>
    </div>

    <button onclick="downloadPDF()">Descargar PDF</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;

        // Configuración del logo (reemplaza con tu URL real de GitHub)
        const logoUrl = "https://raw.githubusercontent.com/tu_usuario/tu_repositorio/main/logo.png";
        const logoImg = new Image();
        logoImg.crossOrigin = "Anonymous";
        logoImg.src = logoUrl;

        const items = [
            "AUTOBUS 45 PLAZAS", "CAMIONETA CARGA", "CAMIONETA VAN", "COMIDAS DEL OPERADOR",
            "COMISION BANCARIA 0.5%", "COORDINADOR", "DERECHOS DE PISO", "HORAS EXTRA",
            "HOSPEDAJE", "MINIBUS 31 PLAZAS", "PARKING", "SEDAN", "SPRINTER", "SUBURBAN",
            "SUBURBAN ADVANCE", "SUBURBAN BLINDADA NIVEL 3", "SUBURBAN HIGH COUNTRY",
            "SUBURBAN LINEA ANTIGUA", "TOYOTA HIACE", "TRAMO CARRETERO", "VAN DE CARGA", "VIATICOS"
        ];

        const itemsContainer = document.querySelector('#items tbody');
        const itemSelect = document.getElementById('item-select');

        // Llenar el menú desplegable con los conceptos
        items.forEach(item => {
            const option = document.createElement('option');
            option.value = item;
            option.textContent = item;
            itemSelect.appendChild(option);
        });

        // Agregar evento al botón "Agregar"
        document.getElementById('add-item-btn').addEventListener('click', addItem);

        function addItem() {
            const selectedItem = itemSelect.value;
            if (selectedItem) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="number" placeholder="Cantidad" class="unit" min="1" value="1" onchange="calculateTotal()"></td>
                    <td>Servicio de Transportación Ejecutiva</td>
                    <td>${selectedItem}</td>
                    <td><input type="number" placeholder="0.00" class="unit-price" min="0" step="0.01" onchange="calculateTotal()"></td>
                    <td class="price">$0.00</td>
                    <td><button class="remove-btn" onclick="removeItem(this)">Eliminar</button></td>
                `;
                itemsContainer.appendChild(row);
                itemSelect.value = '';
                calculateTotal();
            } else {
                alert('Por favor, selecciona un ítem antes de agregar.');
            }
        }

        function removeItem(button) {
            const row = button.closest('tr');
            row.remove();
            calculateTotal();
        }

        function calculateTotal() {
            let subtotal = 0;
            const rows = document.querySelectorAll('#items tbody tr');
            rows.forEach(row => {
                const unitInput = parseFloat(row.querySelector('.unit').value) || 0;
                const unitPriceInput = parseFloat(row.querySelector('.unit-price').value) || 0;
                const priceCell = row.querySelector('.price');
                const price = unitInput * unitPriceInput;
                priceCell.textContent = `$${price.toFixed(2)}`;
                subtotal += price;
            });
            
            const taxRate = parseFloat(document.getElementById('tax').value) || 0;
            const taxAmount = subtotal * (taxRate / 100);
            const total = subtotal + taxAmount;
            
            document.getElementById('total').innerText = `$${total.toFixed(2)}`;
        }

        async function downloadPDF() {
            const doc = new jsPDF();
            
            // Agregar logo al PDF
            try {
                // Crear una nueva imagen para el PDF
                const pdfLogo = new Image();
                pdfLogo.crossOrigin = "Anonymous";
                pdfLogo.src = logoUrl;
                
                // Esperar a que la imagen se cargue
                await new Promise((resolve, reject) => {
                    pdfLogo.onload = resolve;
                    pdfLogo.onerror = () => {
                        console.error("Error al cargar el logo");
                        resolve(); // Continuar incluso si falla
                    };
                });
                
                // Convertir la imagen a base64
                const canvas = document.createElement('canvas');
                canvas.width = pdfLogo.width;
                canvas.height = pdfLogo.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(pdfLogo, 0, 0);
                const logoData = canvas.toDataURL('image/png');
                
                // Agregar la imagen al PDF (centrada, con buen tamaño)
                const pageWidth = doc.internal.pageSize.getWidth();
                const logoWidth = 50; // Ancho del logo en el PDF (ajustable)
                const logoHeight = (pdfLogo.height / pdfLogo.width) * logoWidth;
                doc.addImage(logoData, 'PNG', (pageWidth - logoWidth) / 2, 15, logoWidth, logoHeight);
                
            } catch (error) {
                console.error("Error al cargar el logo:", error);
                // Si falla, agregamos texto alternativo
                doc.setFontSize(16);
                doc.setTextColor(33, 62, 99);
                doc.text("RICHY ENTERTAINMENT", 105, 30, { align: 'center' });
            }

            // Datos del cliente
            const folio = document.getElementById('folio-number').value || 'Sin Folio';
            const clientName = document.getElementById('client-name').value || 'Nombre del Cliente';
            const clientCity = document.getElementById('client-city').value || 'Ciudad';
            const clientPhone = document.getElementById('client-phone').value || 'Teléfono';
            const clientEmail = document.getElementById('client-email').value || 'Email';
            const currentDate = new Date().toLocaleDateString('es-MX', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Encabezado
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Fecha: ${currentDate}`, 14, 40);
            doc.text(`Folio: ${folio}`, 160, 40);
            
            // Información del cliente
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(33, 62, 99);
            doc.text("DATOS DEL CLIENTE", 14, 60);
            
            doc.setFont("helvetica", "normal");
            doc.text(`Nombre: ${clientName}`, 14, 70);
            doc.text(`Ciudad: ${clientCity}`, 14, 80);
            doc.text(`Teléfono: ${clientPhone}`, 14, 90);
            doc.text(`Email: ${clientEmail}`, 14, 100);
            
            // Línea separadora
            doc.setDrawColor(33, 62, 99);
            doc.setLineWidth(0.5);
            doc.line(14, 105, 196, 105);
            
            // Título de la tabla
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("DETALLE DE LA COTIZACIÓN", 14, 115);
            
            // Tabla de items
            const tableData = [];
            const rows = document.querySelectorAll('#items tbody tr');
            rows.forEach(row => {
                const unit = row.querySelector('.unit').value || '1';
                const concept = row.cells[1].textContent;
                const vehicle = row.cells[2].textContent;
                const unitPrice = parseFloat(row.querySelector('.unit-price').value) || 0;
                const price = parseFloat(row.querySelector('.price').textContent.replace('$', '')) || 0;
                tableData.push([
                    unit,
                    concept,
                    vehicle,
                    `$${unitPrice.toFixed(2)}`,
                    `$${price.toFixed(2)}`
                ]);
            });
            
            doc.autoTable({
                head: [['Cant.', 'Concepto', 'Vehículo/Servicio', 'P. Unitario', 'Total']],
                body: tableData,
                startY: 120,
                theme: 'grid',
                headStyles: {
                    fillColor: [33, 62, 99],
                    textColor: [255, 255, 255],
                    fontSize: 10,
                    fontStyle: 'bold'
                },
                bodyStyles: {
                    fontSize: 9
                },
                columnStyles: {
                    0: { cellWidth: 15, halign: 'center' },
                    1: { cellWidth: 50 },
                    2: { cellWidth: 45 },
                    3: { cellWidth: 30, halign: 'right' },
                    4: { cellWidth: 30, halign: 'right' }
                },
                margin: { left: 14, right: 14 }
            });
            
            // Totales
            const yPosition = doc.lastAutoTable.finalY + 10;
            const taxRate = parseFloat(document.getElementById('tax').value) || 0;
            const totalText = document.getElementById('total').textContent;
            const total = parseFloat(totalText.replace('$', '')) || 0;
            const subtotal = total / (1 + taxRate/100);
            const taxAmount = total - subtotal;
            
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text("RESUMEN DE PAGO", 14, yPosition);
            
            doc.setFont("helvetica", "normal");
            doc.text(`Subtotal:`, 150, yPosition);
            doc.text(`$${subtotal.toFixed(2)}`, 180, yPosition, { align: 'right' });
            
            doc.text(`Impuestos (${taxRate}%):`, 150, yPosition + 10);
            doc.text(`$${taxAmount.toFixed(2)}`, 180, yPosition + 10, { align: 'right' });
            
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text(`Total:`, 150, yPosition + 20);
            doc.text(`$${total.toFixed(2)}`, 180, yPosition + 20, { align: 'right' });
            
            // Pie de página
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text("Richy Entertainment S.A.S. de C.V.", 14, 280);
            doc.text("Tel: 52 55 7341 3969 | Email: transpo_rick@hotmail.com", 14, 285);
            doc.text("© 2025 Richy Entertainment. Todos los derechos reservados.", 105, 285, { align: 'center' });
            
            // Guardar PDF
            const fileName = `Cotización_${folio}_${clientName.replace(/[^a-z0-9]/gi, '_')}.pdf`;
            doc.save(fileName);
        }

        // Inicializar cálculos
        calculateTotal();
    </script>
</body>
</html>
